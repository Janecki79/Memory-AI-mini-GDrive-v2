<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Memory AI</title>
  <style>
    :root { --bg:#f7f7fb; --fg:#111; --brand:#2563eb; --ok:#16a34a; --err:#dc2626; --muted:#556; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font:16px system-ui,Segoe UI,Arial}
    header{padding:28px 16px;text-align:center}
    header h1{margin:0 0 6px;font-size:28px;color:var(--brand)}
    header p{margin:0;color:var(--muted)}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px;display:grid;gap:16px}
    .bar{display:grid;grid-template-columns:1fr 260px 160px;gap:8px}
    input,button,textarea{padding:10px 12px;border:1px solid #d9dbe8;border-radius:10px}
    input:focus,textarea:focus{outline:2px solid #c7d2fe;border-color:#c7d2fe}
    button{background:var(--brand);color:#fff;border:none;cursor:pointer}
    button:hover{filter:brightness(.96)}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}
    .card{background:#fff;border:1px solid #e6e8f2;border-radius:16px;box-shadow:0 3px 10px rgba(0,0,0,.04)}
    .card h3{margin:0;padding:14px 16px;border-bottom:1px solid #eef0f8;font-size:18px}
    .card .body{padding:16px;display:grid;gap:10px}
    .row{display:grid;gap:8px}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .small{font-size:12px;color:var(--muted)}
    .out{white-space:pre-wrap;background:#0b1020;color:#d2e3ff;border-radius:12px;padding:10px;font-family:ui-monospace,Consolas,monospace}
    .ok{color:var(--ok)} .err{color:var(--err)}
  </style>
</head>
<body>
  <header>
    <h1>Panel Memory AI</h1>
    <p>Formularze do szybkich akcji na Twoim API</p>
  </header>

  <div class="wrap">
    <!-- Pasek konfiguracji -->
    <div class="bar">
      <input id="base" placeholder="Adres serwera (np. https://memory-ai-mini-gdrive-v2.onrender.com)" />
      <input id="apikey" placeholder="API Key (opcjonalnie)" />
      <button id="ping">Ping /status</button>
    </div>

    <div class="grid">
      <!-- NOTATKA -->
      <div class="card">
        <h3>‚ûï Zapisz notatkƒô (POST /memory/:topic)</h3>
        <div class="body">
          <div class="row2">
            <input id="topic" placeholder="Temat, np. notes" />
            <input id="text" placeholder="Tre≈õƒá notatki" />
          </div>
          <button id="sendNote">Wy≈õlij</button>
          <div class="small">Body: <code>{"text": "..."}</code></div>
        </div>
      </div>

      <!-- UPLOAD LOKALNY -->
      <div class="card">
        <h3>üìÑ Upload lokalny (POST /memory/upload)</h3>
        <div class="body">
          <input id="fileLocal" type="file" />
          <button id="sendLocal">Wy≈õlij plik</button>
          <div class="small">Multipart form-data pole: <code>file</code></div>
        </div>
      </div>

      <!-- UPLOAD DO GOOGLE DRIVE -->
      <div class="card">
        <h3>‚òÅÔ∏è Upload do Google Drive (POST /upload-gdrive)</h3>
        <div class="body">
          <input id="fileGd" type="file" />
          <button id="sendGd">Wy≈õlij do GDrive</button>
          <div class="small">Wymaga konfiguracji: <code>GDRIVE_ENABLED=1</code> + po≈õwiadczenia.</div>
        </div>
      </div>
    </div>

    <!-- Wynik -->
    <div class="card">
      <h3>Wynik</h3>
      <div class="body">
        <div id="out" class="out">‚Äî</div>
      </div>
    </div>
  </div>

<script>
const $ = (id)=>document.getElementById(id);
const out = (msg,cls='')=>{
  const el=$('out');
  el.textContent = typeof msg==='string' ? msg : JSON.stringify(msg,null,2);
  el.className = 'out ' + cls;
};
const base = ()=> $('base').value.trim() || window.location.origin;
const apiKey = ()=> $('apikey').value.trim();

async function req(path, {method='GET', json=null, form=null}={}) {
  const url = (base().replace(/\/$/,'') + path);
  const headers = {};
  if (apiKey()) headers['Authorization'] = `Bearer ${apiKey()}`;
  if (json) headers['Content-Type'] = 'application/json';

  const res = await fetch(url, { method, headers, body: json ? JSON.stringify(json) : (form || null) });
  const ct = res.headers.get('content-type') || '';
  let body;
  if (ct.includes('application/json')) { body = await res.json(); }
  else { body = await res.text(); }
  return { ok: res.ok, status: res.status, body };
}

// Ping
$('ping').onclick = async ()=>{
  try {
    const r = await req('/status');
    out(r, r.ok?'ok':'err');
  } catch(e){ out(String(e),'err'); }
};

// Notatka
$('sendNote').onclick = async ()=>{
  const topic = $('topic').value.trim() || 'notes';
  const text  = $('text').value.trim();
  if(!text) return out('Podaj tre≈õƒá notatki.','err');
  try {
    const r = await req(`/memory/${encodeURIComponent(topic)}`, { method:'POST', json:{ text } });
    out(r, r.ok?'ok':'err');
  } catch(e){ out(String(e),'err'); }
};

// Upload lokalny
$('sendLocal').onclick = async ()=>{
  const f = $('fileLocal').files[0];
  if(!f) return out('Wybierz plik.','err');
  const fd = new FormData(); fd.append('file', f);
  try {
    const r = await req(`/memory/upload`, { method:'POST', form:fd });
    out(r, r.ok?'ok':'err');
  } catch(e){ out(String(e),'err'); }
};

// Upload do GDrive
$('sendGd').onclick = async ()=>{
  const f = $('fileGd').files[0];
  if(!f) return out('Wybierz plik.','err');
  const fd = new FormData(); fd.append('file', f);
  try {
    const r = await req(`/upload-gdrive`, { method:'POST', form:fd });
    out(r, r.ok?'ok':'err');
  } catch(e){ out(String(e),'err'); }
};
</script>
</body>
</html>
